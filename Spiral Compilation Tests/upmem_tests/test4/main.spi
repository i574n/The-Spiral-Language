// Does the variable transfer work?

open utils

inl main () = 
    global "from dpu import DpuSet"
    global "from io import StringIO"
    global "from sys import stdout"
    global "import struct"

    let f (a,b,c,d) = join_backend UPMEM_C_Kernel 
        inl q : i32 = a + b + c + d
        inl w = a * b * c * d
        $"!a = !q"
        $"!b = !w"
        0i32
    inl program, vars = f (1,2,3,4)
    inl dpu = $"DpuSet(nr_dpus=1, c_source=StringIO(!program))" : $"DpuSet"
    real dpu_pack dpu vars
    $"!dpu.exec(log=stdout)"
    inl q,w,_ : i32 * i32 * _ = real dpu_unpack dpu vars
    $"print(!q,!w)"
    ()