open corebase
open console
open tensorm

instance printable tensor dim el = fun t =>
    inl array_limit = 100
    inl length : int = real tensorm.utils.prod t.dim
    write "["
    inl ~q = 0
    cooperative_groups.loop_linear' t.dim (fun i =>
        write (tensor_index i t)
        loop._set q (q + 1)
        if q >= array_limit then 
            write "; ..."
            $"break"
        if q < length then write "; "
        ) 
    write "]"

inl print_first_thread (t : tensor _ _) =
    inl from : int = $"grid_group::thread_rank()"
    if from = 0 then write_ln t
    $"__syncthreads()"
