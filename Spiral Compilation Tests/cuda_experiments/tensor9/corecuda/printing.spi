open corebase
open console
open tensorm

inl tensor_print (array_limit : int) (t : tensor _ _) =
    inl length : int = real tensorm.utils.prod t.dim
    write '['
    inl ~q = 0
    cooperative_groups.loop_linear' t.dim (fun i =>
        write (tensor_index i t)
        loop._set q (q + 1)
        if q >= array_limit then 
            write "; ..."
            $"break"
        if q < length then write "; "
        ) 
    write ']'

instance printable tensor dim el = tensor_print 100

// inl print_first_thread_grid (t : tensor _ _) = cooperative_groups.in_first_thread_grid fun () => printable_tensor true t . write_ln ()
// inl print_first_thread_block (t : tensor _ _) = cooperative_groups.in_first_thread_block fun () => printable_tensor true t . write_ln ()
