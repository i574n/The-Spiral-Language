open corebase
open corecuda
open tensorm
open cupy

type float = f64
type a_layout = wmma.row_major
type b_layout = wmma.col_major

inl main() =
    inl get_body forall dim el. (x : tensor dim el) : array el = 
        real tensorm.utils.map (fun (tensor_body {array}) => array) x.bodies : array el

    inl m,n,k : int * int * int = 8, 8, 4

    inl make dim : _ _ float = arange {from=0; nearTo=prod dim; by=1} |> reshape (const dim)
    inl [a; b; c] = listm.map make [m, k; n, k; m, n]

    open printing
    // tensor_print 20 a
    console.write_ln (zip a b |> rezip (fun a, b => {a b}))
    console.write_ln {a=true; b="fuse"}
    // tensor_print 100 c
    // get_body a, get_body b, get_body c
    