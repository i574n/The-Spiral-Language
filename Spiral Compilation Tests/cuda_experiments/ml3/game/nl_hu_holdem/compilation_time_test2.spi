open corebase
open corecuda
open corepython
open main

inl main() =
    open serializer
    inl ~(msg, game_state) = StartGame, init()
    
    inl seri = {
        msg = create_serializer
        game_state = create_serializer
        ui_state = create_serializer
    }
    
    serialize seri.msg msg
    serialize seri.game_state game_state

    console.write_ln "Going to run the kernel."
    global "import time"
    inl p : f64 = $"time.perf_counter()"
    run fun () =>
        inl from = rangem.threads_in_grid().from
        if from = 0 then
            // inl game_state = event_loop (deserialize seri.msg, deserialize seri.game_state)
            inl game_state = deserialize seri.game_state
            serialize seri.game_state game_state
            serialize seri.ui_state (game_to_ui game_state)
    inl p2 : f64 = $"time.perf_counter()"
    console.write "The time it took to run the kernel (in seconds) is: "
    console.write_ln (p2 - p)
    jsonm.serialize {
        game_state = deserialize seri.game_state
        ui_state = deserialize seri.ui_state
    }
    